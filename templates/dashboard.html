{{template "layout" .}}
{{define "content"}}
<div class="app">
    {{template "sidebar" .}}
    <main class="main">
        <div class="topbar">
            <h1>Proyectos</h1>
            {{if eq .User.Role "admin"}}
            <button class="btn btn-primary btn-sm" onclick="document.getElementById('new-project-modal').showModal()">Nuevo proyecto</button>
            {{end}}
        </div>
        <div class="project-grid">
            {{range .Projects}}
            <a href="/projects/{{.Slug}}" class="project-card">
                <div class="project-card-name">{{.Name}}</div>
                {{if .Description}}<div class="project-card-desc">{{.Description}}</div>{{end}}
                {{if not (eq .MemberRole "client")}}<div class="project-card-role badge badge-{{.MemberRole}}">{{.MemberRole}}</div>{{end}}
            </a>
            {{else}}
            <div class="empty-state">
                <p>No hay proyectos todavía</p>
                {{if eq .User.Role "admin"}}<p>Crea tu primer proyecto para comenzar.</p>{{end}}
            </div>
            {{end}}
        </div>
    </main>
</div>

{{if eq .User.Role "admin"}}
<dialog id="new-project-modal" class="modal">
    <form method="POST" action="/projects">
        <h2>Nuevo proyecto</h2>
        <div class="form-group">
            <label for="name">Nombre</label>
            <input type="text" id="name" name="name" required autofocus>
        </div>
        <div class="form-group">
            <label for="description">Descripción</label>
            <textarea id="description" name="description" rows="3"></textarea>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="this.closest('dialog').close()">Cancelar</button>
            <button type="submit" class="btn btn-primary">Crear</button>
        </div>
    </form>
</dialog>
{{end}}
{{end}}
