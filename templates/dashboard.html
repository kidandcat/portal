{{template "layout" .}}
{{define "content"}}
<div class="app">
    {{template "sidebar" .}}
    <main class="main">
        <div class="topbar">
            <h1>Projects</h1>
            {{if ne .User.Role "client"}}
            <button class="btn btn-primary btn-sm" onclick="document.getElementById('new-project-modal').showModal()">New Project</button>
            {{end}}
        </div>
        <div class="project-grid">
            {{range .Projects}}
            <a href="/projects/{{.Slug}}" class="project-card">
                <div class="project-card-name">{{.Name}}</div>
                {{if .Description}}<div class="project-card-desc">{{.Description}}</div>{{end}}
                <div class="project-card-role badge badge-{{.MemberRole}}">{{.MemberRole}}</div>
            </a>
            {{else}}
            <div class="empty-state">
                <p>No projects yet</p>
                {{if ne .User.Role "client"}}<p>Create your first project to get started.</p>{{end}}
            </div>
            {{end}}
        </div>
    </main>
</div>

{{if ne .User.Role "client"}}
<dialog id="new-project-modal" class="modal">
    <form method="POST" action="/projects">
        <h2>New Project</h2>
        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" required autofocus>
        </div>
        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" rows="3"></textarea>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="this.closest('dialog').close()">Cancel</button>
            <button type="submit" class="btn btn-primary">Create</button>
        </div>
    </form>
</dialog>
{{end}}
{{end}}
