{{define "files_tab"}}
<div class="tab-content">
    {{if not .IsClient}}
    <div class="toolbar">
        <button class="btn btn-primary btn-sm" onclick="document.getElementById('upload-modal').showModal()">Subir archivo</button>
        <button class="btn btn-secondary btn-sm" onclick="document.getElementById('folder-modal').showModal()">Nueva carpeta</button>
    </div>
    {{end}}

    {{if .Breadcrumbs}}
    <div class="breadcrumbs">
        <a href="/projects/{{.Project.Slug}}?tab=files">Ra√≠z</a>
        {{range .Breadcrumbs}}
        <span class="breadcrumb-sep">/</span>
        <a href="/projects/{{$.Project.Slug}}?tab=files&folder={{.ID}}">{{.Name}}</a>
        {{end}}
    </div>
    {{end}}

    {{if .AllImages}}
    <div class="carousel" id="image-carousel">
        <div class="carousel-track">
            {{range $i, $f := .Files}}
            <div class="carousel-slide{{if eq $i 0}} active{{end}}">
                <img src="/projects/{{$.Project.Slug}}/files/{{$f.ID}}/download" alt="{{$f.Name}}" loading="lazy">
                <div class="carousel-caption">{{$f.Name}}</div>
            </div>
            {{end}}
        </div>
        {{if gt (len .Files) 1}}
        <button class="carousel-btn carousel-prev" onclick="carouselNav(-1)">&lsaquo;</button>
        <button class="carousel-btn carousel-next" onclick="carouselNav(1)">&rsaquo;</button>
        <div class="carousel-dots">
            {{range $i, $f := .Files}}
            <span class="carousel-dot{{if eq $i 0}} active{{end}}" onclick="carouselGo({{$i}})"></span>
            {{end}}
        </div>
        {{end}}
    </div>
    {{else}}
    <div class="file-list">
        {{range .Folders}}
        <a href="/projects/{{$.Project.Slug}}?tab=files&folder={{.ID}}" class="file-item file-folder">
            <span class="file-icon">üìÅ</span>
            <span class="file-name">{{.Name}}</span>
        </a>
        {{end}}

        {{range .Files}}
        <div class="file-item">
            <span class="file-icon">üìÑ</span>
            <span class="file-name">{{.Name}}</span>
            <span class="file-size">{{formatSize .Size}}</span>
            <span class="file-uploader">{{if .Uploader}}{{.Uploader.Name}}{{end}}</span>
            <div class="file-actions">
                <a href="/projects/{{$.Project.Slug}}/files/{{.ID}}/download" class="btn btn-secondary btn-xs">Descargar</a>
                {{if not $.IsClient}}
                <button class="btn btn-danger btn-xs"
                    hx-delete="/projects/{{$.Project.Slug}}/files/{{.ID}}"
                    hx-confirm="¬øEliminar este archivo?">√ó</button>
                {{end}}
            </div>
        </div>
        {{else}}
        {{if not $.Folders}}
        <div class="empty-state">No hay archivos todav√≠a</div>
        {{end}}
        {{end}}
    </div>
    {{end}}
</div>

{{if not .IsClient}}
<dialog id="upload-modal" class="modal">
    <form method="POST" action="/projects/{{.Project.Slug}}/files" enctype="multipart/form-data">
        <h2>Subir archivo</h2>
        {{if .CurrentFolder}}<input type="hidden" name="folder_id" value="{{.CurrentFolder}}">{{end}}
        <div class="form-group">
            <label for="file">Archivo</label>
            <input type="file" id="file" name="file" required>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="this.closest('dialog').close()">Cancelar</button>
            <button type="submit" class="btn btn-primary">Subir</button>
        </div>
    </form>
</dialog>

<dialog id="folder-modal" class="modal">
    <form method="POST" action="/projects/{{.Project.Slug}}/folders">
        <h2>Nueva carpeta</h2>
        {{if .CurrentFolder}}<input type="hidden" name="parent_id" value="{{.CurrentFolder}}">{{end}}
        <div class="form-group">
            <label for="folder-name">Nombre</label>
            <input type="text" id="folder-name" name="name" required>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="this.closest('dialog').close()">Cancelar</button>
            <button type="submit" class="btn btn-primary">Crear</button>
        </div>
    </form>
</dialog>
{{end}}
{{end}}
