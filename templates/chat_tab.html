{{define "chat_tab"}}
<div class="tab-content chat-container">
    <div class="chat-messages" id="chat-messages"
         hx-get="/projects/{{.Project.Slug}}/chat/poll?after={{if .Messages}}{{(index .Messages (sub (len .Messages) 1)).ID}}{{else}}0{{end}}"
         hx-trigger="every 5s"
         hx-target="#chat-messages"
         hx-swap="beforeend"
         hx-headers='{"HX-Request": "true"}'>
        {{template "chat_messages" .}}
    </div>

    <form class="chat-input"
          hx-post="/projects/{{.Project.Slug}}/chat"
          hx-target="#chat-messages"
          hx-swap="innerHTML"
          hx-on::after-request="this.reset(); document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;">
        <input type="text" name="content" placeholder="Type a message..." autocomplete="off" required>
        <button type="submit" class="btn btn-primary">Send</button>
    </form>
</div>
{{end}}

{{define "chat_messages"}}
{{range .Messages}}
<div class="chat-msg {{if eq .UserID $.User.ID}}chat-msg-own{{end}}">
    <div class="chat-msg-author">{{.User.Name}}</div>
    <div class="chat-msg-content">{{.Content}}</div>
    <div class="chat-msg-time">{{.CreatedAt.Format "Jan 2, 15:04"}}</div>
</div>
{{end}}
{{end}}
